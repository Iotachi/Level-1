
# Summons jigsaw puzzle item frames
summon minecraft:item_frame 291 106 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 292 106 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 293 106 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 291 107 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 292 107 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 293 107 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 291 108 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 292 108 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}
summon minecraft:item_frame 293 108 35 {Facing:2b,Invulnerable:1b,Tags:["semivulnerable","rotate_remove","jigsaw_clear","s7_kill"]}


# Summons jigsaw pieces
summon minecraft:item 292 105 33 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:15,jigsaw_clear:1b,jigsaw_piece:15s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_center","jigsaw_map","s7_kill"]}
summon minecraft:item 293 105 33 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:16,jigsaw_clear:1b,jigsaw_piece:16s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_center","jigsaw_map","s7_kill"]}
summon minecraft:item 292 105 34 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:19,jigsaw_clear:1b,jigsaw_piece:19s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_center","jigsaw_map","s7_kill"]}
summon minecraft:item 293 105 34 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:20,jigsaw_clear:1b,jigsaw_piece:20s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_center","jigsaw_map","s7_kill"]}

summon minecraft:item 291 105 32 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:10,jigsaw_clear:1b,jigsaw_piece:10s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 292 105 32 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:11,jigsaw_clear:1b,jigsaw_piece:11s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 293 105 32 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:12,jigsaw_clear:1b,jigsaw_piece:12s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 294 105 32 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:13,jigsaw_clear:1b,jigsaw_piece:13s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}

summon minecraft:item 291 105 33 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:14,jigsaw_clear:1b,jigsaw_piece:14s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 294 105 33 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:17,jigsaw_clear:1b,jigsaw_piece:17s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}

summon minecraft:item 291 105 34 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:18,jigsaw_clear:1b,jigsaw_piece:18s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 294 105 34 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:21,jigsaw_clear:1b,jigsaw_piece:21s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}

summon minecraft:item 291 105 35 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:22,jigsaw_clear:1b,jigsaw_piece:22s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 292 105 35 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:23,jigsaw_clear:1b,jigsaw_piece:23s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 293 105 35 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:24,jigsaw_clear:1b,jigsaw_piece:24s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}
summon minecraft:item 294 105 35 {Item:{id:"minecraft:filled_map",Count:1b,tag:{map:25,jigsaw_clear:1b,jigsaw_piece:25s,HideFlags:32,display:{Name:'{"text":"-","italic":false,"obfuscated":true}'}}},Tags:["jigsaw_map","s7_kill"]}


# Selects a 3x3 part of the puzzle
execute at @e[type=minecraft:item,tag=jigsaw_center,limit=1,sort=random] run tag @e[type=minecraft:item,tag=jigsaw_map,limit=9,sort=nearest] add jigsaw_piece

# Selects an extra piece
tag @e[type=minecraft:item,tag=jigsaw_map,tag=!jigsaw_piece,limit=1,sort=random] add jigsaw_extra

# Kills all other pieces
kill @e[type=minecraft:item,tag=jigsaw_map,tag=!jigsaw_piece,tag=!jigsaw_extra]


# Setting extra piece's number
scoreboard players set @e[type=minecraft:item,tag=jigsaw_extra] code 27
scoreboard players operation @e[type=minecraft:item,tag=jigsaw_extra] code += @e[type=minecraft:item_frame,tag=jigsaw] code

# Setting other pieces' numbers
scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece] code 0
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=27}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 27
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=28}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 28
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=29}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 29
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=30}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 30
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=31}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 31
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=32}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 32
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=33}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 33
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=34}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 34
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=35}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 35
execute unless entity @e[type=minecraft:item,tag=jigsaw_extra,scores={code=36}] run scoreboard players set @e[type=minecraft:item,tag=jigsaw_piece,limit=1,sort=random,scores={code=0}] code 36

# Converting piece numbers from score to data
execute as @e[type=minecraft:item,tag=jigsaw_map] store result entity @s Item.tag.jigsaw_number short 1 run scoreboard players get @s code


# Copying map items into chest
data modify block 298 93 3 Items[0].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=27}] Item.tag
data modify block 298 93 3 Items[1].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=28}] Item.tag
data modify block 298 93 3 Items[2].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=29}] Item.tag
data modify block 298 93 3 Items[3].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=30}] Item.tag
data modify block 298 93 3 Items[4].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=31}] Item.tag
data modify block 298 93 3 Items[5].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=32}] Item.tag
data modify block 298 93 3 Items[6].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=33}] Item.tag
data modify block 298 93 3 Items[7].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=34}] Item.tag
data modify block 298 93 3 Items[8].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=35}] Item.tag
data modify block 298 93 3 Items[9].tag set from entity @e[type=minecraft:item,tag=jigsaw_map,limit=1,scores={code=36}] Item.tag

# Killing map items
kill @e[type=minecraft:item,tag=jigsaw_map]